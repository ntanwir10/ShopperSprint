// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model Product {
  id             String           @id @default(cuid())
  name           String
  normalizedName String
  category       String?
  specifications Json?
  createdAt      DateTime         @default(now())
  updatedAt      DateTime         @updatedAt
  listings       ProductListing[]

  @@map("products")
}

model ProductListing {
  id           String    @id @default(cuid())
  productId    String
  sourceId     String
  url          String
  price        Float
  currency     String    @default("USD")
  availability String    // 'in_stock' | 'out_of_stock' | 'limited' | 'unknown'
  imageUrl     String?
  rating       Float?
  reviewCount  Int?
  lastScraped  DateTime  @default(now())
  isValid      Boolean   @default(true)
  product      Product   @relation(fields: [productId], references: [id], onDelete: Cascade)
  source       Source    @relation(fields: [sourceId], references: [id])
  searches     Search[]  @relation("SearchResults")

  @@map("product_listings")
}

model Search {
  id        String           @id @default(cuid())
  query     String
  userId    String?
  metadata  Json?
  createdAt DateTime         @default(now())
  results   ProductListing[] @relation("SearchResults")

  @@map("searches")
}

model Source {
  id                    String           @id @default(cuid())
  name                  String           @unique
  category              String           // 'popular' | 'alternative'
  isActive              Boolean          @default(true)
  lastSuccessfulScrape  DateTime?
  errorCount            Int              @default(0)
  averageResponseTime   Float?
  configuration         Json
  createdAt             DateTime         @default(now())
  updatedAt             DateTime         @updatedAt
  listings              ProductListing[]

  @@map("sources")
}

model Advertisement {
  id          String    @id @default(cuid())
  title       String
  description String
  imageUrl    String
  targetUrl   String
  category    String
  keywords    String[]
  isActive    Boolean   @default(true)
  impressions Int       @default(0)
  clicks      Int       @default(0)
  createdAt   DateTime  @default(now())
  expiresAt   DateTime?

  @@map("advertisements")
}